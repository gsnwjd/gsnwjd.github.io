<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="&amp;nbsp;&amp;nbsp;——本文禁止转载,分享请注明网站出处 : )在6月21日至7月31日之间，我通过网课和官方文档学习了nodejs的基本知识，包括一些基本模块，express框架，模板ejs，jade和数据库（MySQL）方面的用法，顺带一提的是，express处理数据的无限回调令人头(zuo">
    

    <!--Author-->
    
        <meta name="author" content="gsnwjd王佳典">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="NodeJs基础入门实录">
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="嗯哼~">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>NodeJs基础入门实录 - 嗯哼~</title>

    <!-- Tachyons Core CSS -->
    <link rel="stylesheet" href="//unpkg.com/tachyons/css/tachyons.min.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<!-- Main Content -->
<!-- Banner -->
<!-- Banner -->
<div class="w-100 bg-1 ph5-ns ph3 text-light">
    
    <nav class="db dt-l w-100 mw8 center border-box pv3">
        <a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="嗯哼~">
            <img src="http://www.codeblocq.com/assets/projects/hexo-theme-anodyne/assets/anodyne.svg" class="dib h3" alt="嗯哼~">
        </a>
        <div class="db dtc-l v-mid w-100 w-75-l tc tr-l">
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">
                    Home
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/archives" title="Archives">
                    Archives
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/tags" title="Tags">
                    Tags
                </a>
            
        </div>
    </nav>

    <!-- Title -->
    <div class="w-100 mw8 center vh-40 dt">
        <div class="dtc v-mid white">
            <h1 class="f1-l f2-m tc tc-m tl-ns">NodeJs基础入门实录</h1>
            <p class="f4 fw3 pab-100px tc tc-m tl-ns">2019-08-18</p>
        </div>
    </div>

    <!-- Icon -->
    <div class="relative w-100 mw8 center white dn dn-m db-ns">
        <i class="header-icon fa fa-lightbulb-o"></i>
    </div>
</div>

<!-- Content -->
<div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l">
    <div class="content">
        <div class="mw8 center">
            <div class="cf">
                <div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content">
                    <!-- Tags Vertical -->
                    
                        <div class="tags-container-vertical">
                            <div class="tags-sub-container">
                                <a class="fw3 ph1 dib" href="/tags/学不完的js/">#学不完的js</a>
                            </div>
                        </div>
                    

                    <!-- Main Post Content -->
                    <p><span style="color:#8c8c8c;border-left:4px solid #f2f233;">&nbsp;&nbsp;——本文禁止转载,分享请注明网站出处 : )</span><br><br><br>在6月21日至7月31日之间，我通过网课和官方文档学习了nodejs的基本知识，包括一些基本模块，express框架，模板ejs，jade和数据库（MySQL）方面的用法，顺带一提的是，express处理数据的无限回调令人头(zuo)大(ou)，幸好koa框架更加人性化，但是网课里用的是express，所以这里只打算记录一下express。<br>之后我会记录koa框架+SSR浏览器端渲染数据的教程</p>
<p></p><p style="color:#85826c;font-weight:bold;font-size:20px;height:40px;padding-top: 15px;">基础模块</p><br>除了nodejs之外我们还需要安装以下工具<br>npm:包/模块管理器<br>Git Bash:更方便地执行linux命令，不用面对难用的cmd<br><span style="color:#97ac70;">如果不会安装，可以去知乎/掘金上查找教程。</span><br><br><span style="color:#b4dace;">一些必备常识:</span><br>盘符：<span style="border-bottom:1px solid #2ead87;">e:&nbsp;<br></span><br>进入文件夹：<span style="border-bottom:1px solid #2ead87;">cd&nbsp;&nbsp;e:/test/<br></span><br>启动js文件：<span style="border-bottom:1px solid #2ead87;">node&nbsp;server.js<br></span><br>下载依赖模块：<span style="border-bottom:1px solid #2ead87;">npm&nbsp;i&nbsp;模块名(例如：body-parser)<br></span><br>监听：<span style="border-bottom:1px solid #2ead87;">server.listen(端口号);<br></span><p></p>
<p></p><p style="color:#846e5e;font-weight:bold">HTTP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const http=require(&apos;http&apos;);//1.引入模块</span><br><span class="line">var server=http.createServer(function (request, response)&#123;</span><br><span class="line">  console.log(&apos;node&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">//2.监听——等着</span><br><span class="line">//端口-数字</span><br><span class="line">server.listen(8080);</span><br></pre></td></tr></table></figure><br><span style="color:goldenrod;">然后将上述内容保存为server.js，以下有两种方法来启动server.js</span><br><br><span style="color:rgb(58, 167, 167);font-style:italic;">1.</span><br><span style="color:rgb(38, 112, 112);">点击VScode菜单栏倒数第二个选项：终端。我们选择新建终端，在终端处输入node server.js。</span><br><br><span style="color:rgb(58, 167, 167);font-style:italic;">2.</span><br><span style="color:rgb(38, 112, 112);">在文件资源管理器处打开server.js所在文件夹，然后右键点击文件夹空白处，选择<span style="border:1px dotted rgb(172, 12, 124);">Git Bash Here</span>，再在gitbash命令行里面输入node server.js即可。</span><br><br>nodejs建一个后台是非常简单的，只需要<span style="color:#996600;font-style:italic;">引入模块&amp;利用模块创建服务器</span>，现在打开<span style="color:goldenrod;font-weight:bold;">localhost:8080</span>,你就可以看到终端：node——这说明你成功创建了一个能够运行的初始后台。request表示请求，response表示响应，这两个词没有固定要求，大部分人会简写成req和res。客户端请求(req)，服务端响应(res)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const http=require(&apos;http&apos;);</span><br><span class="line">var server=http.createServer(function (req, res)&#123;</span><br><span class="line">  res.write(&quot;abc&quot;);</span><br><span class="line">  res.end();</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(8080);</span><br></pre></td></tr></table></figure><br>尝试从服务端写入数据,用res.write(),在最后需要添加res.end();否则会报错。上述例子在运行之后，页面会出现abc。<p></p>
<p></p><p style="color:#846e5e;font-weight:bold">querystring</p>querystring是nodejs自带的解析请求字符串的模块，常用的是querystring.parse()用法，将请求字符串解析为json对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const querystring=require(&apos;querystring&apos;);</span><br><span class="line"></span><br><span class="line">var json=querystring.parse(&quot;user=blue&amp;pass=123456&amp;age=18&quot;);</span><br><span class="line">console.log(json);</span><br></pre></td></tr></table></figure><br>上述代码在终端运行会出现如下效果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Object: null prototype] &#123; user: &apos;blue&apos;, pass: &apos;123456&apos;, age: &apos;18&apos; &#125;</span><br></pre></td></tr></table></figure><br>querystring.stringify()与querystring.parse()相对。<br><span style="color:#996600;font-style:italic;">此模块最常用的就是解析get传过来的数据。</span><p></p>
<p></p><p style="color:#846e5e;font-weight:bold">url</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const urllib=require(&apos;url&apos;)</span><br><span class="line">let obj=urllib.parse(&quot;http://www.yes.com/index?a=1&amp;b=coco&quot;,true)</span><br><span class="line">console.log(obj.pathname,obj.query)</span><br></pre></td></tr></table></figure><br>上述文件运行在终端会出现<span style="border-bottom:1px dotted rgb(194, 124, 19);"> /index [Object: null prototype] { a: ‘1’, b: ‘coco’ } </span>url此模块可以解析出路由和传递的参数，并且把传递的参数转化为json格式。<p></p>
<p></p><p style="color:#846e5e;font-weight:bold">fs</p>fs是用来处理文件的模块。常见的文件处理有——读取，重命名，管理上传。<p></p>
<p></p><p style="color:#a96b3e;">读取</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const fs=require(&apos;fs&apos;);</span><br><span class="line"></span><br><span class="line">//readFile(文件名, 回调函数)</span><br><span class="line">fs.readFile(&apos;a.txt&apos;, function (err, data)&#123;</span><br><span class="line">  if(err)&#123;</span><br><span class="line">    console.log(&apos;读取失败&apos;);</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    console.log(data.toString());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><span style="color:#996600;font-style:italic;">直接读取会呈现buffer形式的内容，也就是二进制。所以需要将其转换为字符串。</span>上述js文件运行后在终端可以呈现a.txt里的内容<p></p>
<p></p><p style="color:#a96b3e;">内容写入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const fs=require(&apos;fs&apos;);</span><br><span class="line">//writeFile(文件名, 内容, 回调)</span><br><span class="line">fs.writeFile(&quot;a.txt&quot;, &quot;a.txt的内容&quot;, function (err)&#123;</span><br><span class="line">  console.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p>
<p></p><p style="color:#a96b3e;">删除文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const fs=require(&apos;fs&apos;);</span><br><span class="line">fs.unlink(&quot;b.txt&quot;,(err)=&gt;&#123;</span><br><span class="line">    console.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>vscode文件目录处可以看到b.txt已经删除。<br><span style="color:#996600;font-style:italic;">此方法常常用来管理上传文件的修改，源文件要删除以免占用空间。</span><p></p>
<p></p><p style="color:#846e5e;font-weight:bold">自定义模块输出</p><p></p>
<p></p><p style="color:#a96b3e;">模块输出(命名为test.js)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;a:1,b:5&#125;;</span><br></pre></td></tr></table></figure><p></p>
<p></p><p style="color:#a96b3e;">模块引入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const all=require(&apos;./test&apos;);/*引入模块，若是当前目录，文件路径需要加上./</span><br><span class="line">如果直接放在文件夹node_modules内，则不需要。*/</span><br><span class="line">console.log(all.a);</span><br></pre></td></tr></table></figure><br>上述结果运行可以在终端看见1。<br><br>此方法常常用于mongodb数据库的连接。自定义一个config，指明存放数据的地址。然后在总接口处引入，连接MongoDB数据库。<br>常用的还有定义一些常用函数模块。如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//模块test.js</span><br><span class="line">exports.sum=function ()&#123;</span><br><span class="line">  var res=0;</span><br><span class="line"></span><br><span class="line">  for(var i=0;i&lt;arguments.length;i++)&#123;</span><br><span class="line">    res+=arguments[i];//arguments代表传进来的所有参数</span><br><span class="line">  &#125;</span><br><span class="line">  return res;</span><br><span class="line">&#125;;</span><br><span class="line">exports.div=function (a, b)&#123;</span><br><span class="line">  return a/b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//新建一个文件1.js</span><br><span class="line">const test=require(&apos;test&apos;);</span><br><span class="line">console.log(test.sum(10, 5));</span><br></pre></td></tr></table></figure>node 1.js,终端打印出15<p></p>
<p></p><p style="color:#85826c;font-weight:;font-size:20px;height:40px;padding-top: 15px;">Express</p><p></p>
<p></p><p style="color:#a96b3e;">安装 =&gt; 配置 =&gt; 接收请求 =&gt; 响应</p><br><span style="color:rgb(58, 167, 167);font-style:italic;">1.</span><br>利用express创建服务器之后，有三种处理数据的方法:<span style="border-bottom:1px dotted rgb(194, 104, 19);">server.get(‘/‘,function(req,res){});&nbsp;&nbsp;server.post(‘/‘,function(req,res){});&nbsp;&nbsp;server.use(‘/‘,function(req,res){});</span>use方法既可以接收get数据也可以接收post数据<br><span style="color:rgb(58, 167, 167);font-style:italic;">2.</span>在express里，可以用res.send()发送json格式的数据。这一点，res.write()做不到。<br><br>以下示例如何简单验证使用get方式传来的数据<br>首先安装依赖：npm i express express-static<br><br><span style="color:#996600;font-style:italic;">（express-static是中间件，用来加载静态资源</span><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">//放置在根目录文件下的server.js</span><br><span class="line">const express=require(&apos;express&apos;);</span><br><span class="line">const expressStatic=require(&apos;express-static&apos;);</span><br><span class="line"></span><br><span class="line">var server=express();</span><br><span class="line">server.listen(8080);</span><br><span class="line"></span><br><span class="line">server.use(expressStatic(&apos;./www&apos;));//指定静态文件存放路径</span><br><span class="line"></span><br><span class="line">//用户数据</span><br><span class="line">var users=&#123;</span><br><span class="line">  &apos;lily&apos;: &apos;123&apos;,</span><br><span class="line">  &apos;coco&apos;: &apos;abc&apos;</span><br><span class="line">&#125;;</span><br><span class="line">server.get(&apos;/login&apos;, function (req, res)&#123;</span><br><span class="line">  var user=req.query[&apos;user&apos;];</span><br><span class="line">  var pass=req.query[&apos;pass&apos;];</span><br><span class="line"></span><br><span class="line">  if(users[user]==null)&#123;</span><br><span class="line">    res.send(&#123;ok: false, msg: &apos;此用户不存在&apos;&#125;);</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    if(users[user]!=pass)&#123;</span><br><span class="line">      res.send(&#123;ok: false, msg: &apos;密码错了&apos;&#125;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      res.send(&#123;ok: true, msg: &apos;成功&apos;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//放置在www文件夹下的form.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;form action=&quot;http://localhost:8080/login&quot; method=&quot;get&quot;&gt;</span><br><span class="line">      用户：&lt;input type=&quot;text&quot; name=&quot;user&quot; /&gt;</span><br><span class="line">      密码：&lt;input type=&quot;text&quot; name=&quot;pass&quot; /&gt;</span><br><span class="line">      &lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>改用post也可以。只是需要再下载一个模块<span style="border-bottom:1px dotted rgb(194, 104, 19);">body-parser</span>，并且要修改代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const bodyParser=require(&apos;body-parser&apos;);</span><br><span class="line">server.use(bodyParser.urlencoded(&#123;&#125;));</span><br><span class="line">//使用中间件</span><br><span class="line">server.post(&apos;/login&apos;, function (req, res)&#123;//此处可用post，可用use</span><br><span class="line">  console.log(req.body);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>body-parser可以限制传输文件大小和扩展模式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server.use(bodyParser.urlencoded(&#123;</span><br><span class="line">	extended: false,                 //扩展模式</span><br><span class="line">	limit:    2*1024*1024           //限制2M</span><br><span class="line">  &#125;));</span><br></pre></td></tr></table></figure><br>当我们在www文件夹里新建一个表单网页，并且用post方式传数据的时候，可以在终端看到json数据。例如：{ user: ‘关四鸟’, pass: ‘123’ }<p></p>
<p></p><p style="color:#846e5e;font-weight:bold">session和cookie</p><br>种一个cookie非常简单<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server.use(&apos;/test/1.html&apos;,function(req,res)&#123;</span><br><span class="line">	res.cookie(&apos;user&apos;, &apos;gsn&apos;, &#123;path: &apos;/test&apos;, maxAge: 30*24*3600*1000&#125;);</span><br><span class="line">//user:cookie的名称</span><br><span class="line">//gsn:cookie的值</span><br><span class="line">//&#123;path:存放路径，默认值为&apos;/&apos;,maxAge:存放时间，以毫秒计算&#125;</span><br><span class="line">/*&#123;&#125;中还可以填一个重要的选项——signed，但是signed要求cookie-parser模块的安装以及使用*/</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br>安装cookie-parser之后具体使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const express=require(&apos;express&apos;)</span><br><span class="line">const cookieParser=require(&apos;cookie-parser&apos;)</span><br><span class="line">let server=express()</span><br><span class="line">//cookie</span><br><span class="line">server.use(cookieParser(&apos;234567890wdd&apos;))//指定密钥方法1</span><br><span class="line">server.use(&apos;/3.html&apos;, function (req, res)&#123;</span><br><span class="line">  req.secret=&apos;234567890wdd&apos;//指定密钥方法2</span><br><span class="line">  res.cookie(&apos;coco&apos;, &apos;123&apos;, &#123;signed: true&#125;)</span><br><span class="line">  res.send(&apos;OK&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(8080)</span><br></pre></td></tr></table></figure><br>打开localhost:8080/3.html，右键点击页面-检查-打开Application-打开cookies查看<br>
<table style="font-size:10px;">
	<tr>
		<td>Name</td>
		<td>Value</td>
		<td>Domain</td>
		<td>Path</td>
		<td>Expires/Max-Age</td>
		<td>Size</td>
		<td>HTTP</td>
		<td>Secure</td>
		<td>SameSite</td>
	</tr>
	<tr>
		<td>coco</td>
		<td>s%3A123.zru3dvtug3StnPQZI6mP6ZtuTX3klBUCdo56Xpngfik</td>
		<td>localhost</td>
		<td>/</td>
		<td>1969-12-31T23:59:59.000Z</td>
		<td>55</td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
</table>
<br>想要清除cookie非常简单，代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const express=require(&apos;express&apos;);</span><br><span class="line">const cookieParser=require(&apos;cookie-parser&apos;);</span><br><span class="line">let server=express()</span><br><span class="line"></span><br><span class="line">server.use(cookieParser(&apos;wesdfw4r34tf&apos;))</span><br><span class="line">server.use(&apos;/3.html&apos;, function (req, res)&#123;</span><br><span class="line">  res.clearCookie(&apos;coco&apos;);</span><br><span class="line">  res.send(&apos;ok&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(8080);</span><br></pre></td></tr></table></figure><br>当我们打开浏览器的Application去查看的时候，发现cookie已经清除。<br><br>cookie有很多缺点，比如不够安全，空间有限，只有4k个字节可供使用。基于cookie实现的session就相对来说更加安全一些，并且它是保存数据在服务端的，它的空间无限。<br><br><span style="color:rgb(38, 112, 112);">下载cookie-session(npm i cookie-session)</span><br><br>当我们运行以下代码的时候，可以打开浏览器查看cookies<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const express=require(&apos;express&apos;);</span><br><span class="line">const cookieParser=require(&apos;cookie-parser&apos;);</span><br><span class="line">const cookieSession=require(&apos;cookie-session&apos;);</span><br><span class="line"></span><br><span class="line">var server=express();</span><br><span class="line"></span><br><span class="line">server.use(cookieParser());</span><br><span class="line">server.use(cookieSession(&#123;</span><br><span class="line">  keys: [&apos;aaa&apos;, &apos;bbb&apos;, &apos;ccc&apos;]</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">server.use(&apos;/&apos;, function (req, res)&#123;</span><br><span class="line">  req.session[&apos;coco&apos;]=2;</span><br><span class="line">  console.log(req.session[&apos;coco&apos;]);</span><br><span class="line">  res.send(&apos;ok&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(1125);</span><br></pre></td></tr></table></figure><br>我们可以看到终端打印出2，且浏览器cookie处显示如下<br>
<table style="font-size:10px;">
	<tr>
		<td>Name</td>
		<td>Value</td>
		<td>Domain</td>
		<td>Path</td>
		<td>Expires/Max-Age</td>
		<td>Size</td>
		<td>HTTP</td>
		<td>Secure</td>
		<td>SameSite</td>
	</tr>
	<tr>
		<td>session</td>
		<td>eyJjb2NvIjoyfQ==</td>
		<td>localhost</td>
		<td>/</td>
		<td>1969-12-31T23:59:59.000Z</td>
		<td>23</td>
		<td>✓</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>session.sig</td>
		<td>CumeOCBXX8ZIo7l6LM8OdRcCbAs</td>
		<td>localhost</td>
		<td>/</td>
		<td>1969-12-31T23:59:59.000Z</td>
		<td>38</td>
		<td>✓</td>
		<td></td>
		<td></td>
	</tr>
</table>
<br>我们可以利用session制作一个简易的记录浏览次数的小工具<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">const express=require(&apos;express&apos;);</span><br><span class="line">const cookieParser=require(&apos;cookie-parser&apos;);</span><br><span class="line">const cookieSession=require(&apos;cookie-session&apos;);</span><br><span class="line"></span><br><span class="line">var server=express();</span><br><span class="line"></span><br><span class="line">var arr=[];</span><br><span class="line">for(var i=0;i&lt;100000;i++)&#123;</span><br><span class="line">  arr.push(&apos;sig_&apos;+Math.random());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server.use(cookieParser());</span><br><span class="line">server.use(cookieSession(&#123;</span><br><span class="line">  name: &apos;sess&apos;,</span><br><span class="line">  keys: arr,</span><br><span class="line">  maxAge: 2*3600*1000</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">server.use(&apos;/&apos;, function (req, res)&#123;</span><br><span class="line">  if(req.session[&apos;count&apos;]==null)&#123;</span><br><span class="line">    req.session[&apos;count&apos;]=1;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    req.session[&apos;count&apos;]++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  console.log(req.session[&apos;count&apos;]);</span><br><span class="line"></span><br><span class="line">  res.send(&apos;ok&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(1125);</span><br></pre></td></tr></table></figure><br><span style="color:#996600;font-style:italic;">当我们不断刷新页面的时候，我们会在终端看到1,2,3,4这样的持续输出。</span><p></p>
<p></p><p style="color:#85826c;font-weight:bold;font-size:20px;height:40px;padding-top: 15px;">模板引擎及路由</p><br><span style="color:#b4dace;">（渲染出来的页面有一部分跟随程序生成）</span><br>常见模板有两种——jade和ejs，jade属于侵入式，破坏式的模板，已经被淘汰，以下只想详细记录ejs的用法<p></p>
<p></p><p style="color:#846e5e;font-weight:bold">ejs</p><span style="color:rgb(207, 60, 129);font-style:italic;">a.</span><br><span style="color:rgb(160, 143, 151);">数据传递  &lt;%=变量名%&gt;</span><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1.js</span><br><span class="line">const ejs=require(&apos;ejs&apos;)</span><br><span class="line">ejs.renderFile(&apos;./views/1.ejs&apos;, &#123;name: &apos;blue&apos;&#125;, function (err, data)&#123;</span><br><span class="line">  console.log(data)</span><br><span class="line">  //渲染时候传递数据，以json形式放在花括号里</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">1.ejs</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;%=name%&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br> json数据有多层的时候也是像js引用变量一样引用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2.js</span><br><span class="line">const ejs=require(&apos;ejs&apos;)</span><br><span class="line">ejs.renderFile(&apos;./views/2.ejs&apos;, &#123;json: &#123;arr: [</span><br><span class="line">  &#123;user: &apos;zhangsan&apos;, pass: &apos;123&apos;&#125;,</span><br><span class="line">  &#123;user: &apos;xiaoming&apos;, pass: &apos;999&apos;&#125;,</span><br><span class="line">]&#125;&#125;, function (err, data)&#123;</span><br><span class="line">  console.log(data);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">2.ejs（内嵌部分）</span><br><span class="line">&lt;%=json.arr[0].user%&gt;</span><br></pre></td></tr></table></figure>终端可以看到输出”zhangsan”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=12+5%&gt;</span><br><span class="line">以上在浏览器端会直接输出17</span><br></pre></td></tr></table></figure><br><span style="color:rgb(207, 60, 129);font-style:italic;">b.</span><br><span style="color:rgb(160, 143, 151);">内嵌动态js：示例一个循环</span><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">若4.js里面传递的数据是</span><br><span class="line">&#123;json: &#123;arr: [</span><br><span class="line">  &#123;user: &apos;zhangsan&apos;, pass: &apos;123&apos;&#125;,</span><br><span class="line">  &#123;user: &apos;xiaoming&apos;, pass: &apos;999&apos;&#125;,</span><br><span class="line">]&#125;&#125;</span><br><span class="line"></span><br><span class="line">4.ejs</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;% for(var i=0;i&lt;json.arr.length;i++)&#123; %&gt;</span><br><span class="line">    &lt;div&gt;用户名：&lt;%=json.arr[i].user%&gt; 密码：&lt;%=json.arr[i].pass%&gt;&lt;/div&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">&lt;/body&gt; </span><br></pre></td></tr></table></figure><br>我们会得到如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div&gt;用户名：zhangsan 密码：123&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;用户名：xiaoming 密码：999&lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br><span style="color:rgb(207, 60, 129);font-style:italic;">c.</span><br><span style="color:rgb(160, 143, 151);">“=”是转义输出，”-“是不转义输出</span><br>当我们要输出标签形式的内容时，如&lt;div&gt;&lt;/div&gt;我们需要不转义输出<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ejs内嵌部分(转义输出)</span><br><span class="line">&lt;%</span><br><span class="line">var str=&quot;&lt;div&gt;&lt;/div&gt;&quot;;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%= str %&gt;</span><br><span class="line"></span><br><span class="line">终端输出</span><br><span class="line">&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;</span><br><span class="line"></span><br><span class="line">ejs内嵌部分(不转义输出)</span><br><span class="line">&lt;%</span><br><span class="line">var str=&quot;&lt;div&gt;&lt;/div&gt;&quot;;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%- str %&gt;</span><br><span class="line"></span><br><span class="line">终端输出</span><br><span class="line">&lt;div&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><br><span style="color:rgb(207, 60, 129);font-style:italic;">d.</span><br><span style="color:rgb(160, 143, 151);">include关键字的用法</span><br>include意为引入一个文件，可以引入css script等文件，但是注意文件路径一定要正确。<br>我们可以和条件结合使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">6.ejs(关键部分)</span><br><span class="line">&lt;%if(type==&apos;admin&apos;)&#123; %&gt;</span><br><span class="line">    &lt;%include ../style/admin.css%&gt;</span><br><span class="line">    &lt;%&#125;else&#123; %&gt;</span><br><span class="line">    &lt;%include ../style/user.css%&gt;</span><br><span class="line">    &lt;%&#125;%&gt;</span><br><span class="line">    </span><br><span class="line">6.js</span><br><span class="line">const ejs=require(&apos;ejs&apos;);</span><br><span class="line">ejs.renderFile(&apos;./views/6.ejs&apos;, &#123;type: &apos;admin&apos;&#125;, function (err, data)&#123;</span><br><span class="line">  console.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">浏览器端输出</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    </span><br><span class="line">    /*admin.css*/</span><br><span class="line">div &#123;width:200px;&#125;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p></p>
<p>用变量传递地址也是完全可以<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">7.js</span><br><span class="line">const ejs=require(&apos;ejs&apos;);</span><br><span class="line">ejs.renderFile(&apos;./views/7.ejs&apos;, &#123;css_path: &apos;../style/admin.css&apos;&#125;, function (err, data)&#123;</span><br><span class="line">  console.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">7.ejs</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;% include css_path %&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p></p><p style="color:#846e5e;font-weight:bold">consolidate</p>express适配所有的引擎会比较麻烦，consolidate提供了一个统一接口。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//引入consolidate模块</span><br><span class="line">const consolidate=require(&apos;consolidate&apos;)</span><br><span class="line">//输出什么东西</span><br><span class="line">server.set(&apos;view engine&apos;, &apos;html&apos;)</span><br><span class="line">//模板文件放在哪儿</span><br><span class="line">server.set(&apos;views&apos;, &apos;./views&apos;)</span><br><span class="line">//哪种模板引擎</span><br><span class="line">server.engine(&apos;html&apos;, consolidate.ejs)</span><br></pre></td></tr></table></figure><p></p>
<p></p><p style="color:#846e5e;font-weight:bold">router</p>express配置了router<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const express=require(&apos;express&apos;);</span><br><span class="line">var server=express();</span><br><span class="line"></span><br><span class="line">// /user/目录下</span><br><span class="line">var routeUser=express.Router();</span><br><span class="line"></span><br><span class="line">routeUser.get(&apos;/1.html&apos;, function (req, res)&#123;   //http://xxx.com/user/1.html</span><br><span class="line">  res.send(&apos;user1&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">routeUser.get(&apos;/2.html&apos;, function (req, res)&#123;   //http://xxx.com/user/2.html</span><br><span class="line">  res.send(&apos;user22222&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.use(&apos;/user&apos;, routeUser);//第一个参数是前缀，第二个参数是路由</span><br></pre></td></tr></table></figure><p style="color:#85826c;font-weight:bold;font-size:20px;height:40px;padding-top: 15px;">数据库</p>记得先下载mysql模块&nbsp;&nbsp;&nbsp;<span style="color:#b4dace;">npm i mysql</span><br><p></p>
<p></p><p style="color:#846e5e;font-weight:bold">连接和连接池</p><br>直接创建连接，用createConnection()方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const mysql=require(&apos;mysql&apos;);</span><br><span class="line"></span><br><span class="line">//1.连接</span><br><span class="line">//createConnection(哪台服务器, 用户名, 密码, 库)</span><br><span class="line">var db=mysql.createConnection(&#123;host: &apos;localhost&apos;, user: &apos;root&apos;, password: &apos;123456&apos;, database: &apos;test&apos;&#125;);</span><br><span class="line"></span><br><span class="line">//2.查询</span><br><span class="line">//query(操作, 回调)</span><br><span class="line">db.query(&quot;SELECT * FROM `user_table`;&quot;, (err, data)=&gt;&#123;</span><br><span class="line">  if(err)&#123;</span><br><span class="line">   console.log(&apos;出错了&apos;, err);</span><br><span class="line">  &#125;</span><br><span class="line">  else&#123;</span><br><span class="line">  	console.log(&apos;成功了&apos;);</span><br><span class="line">	console.log(JSON.stringify(data));</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">	/*JSON.stringify()从一个对象中解析出字符串</span><br><span class="line">	var data=&#123;name:&apos;goatling&apos;&#125;</span><br><span class="line">	JSON.stringify(data)</span><br><span class="line">	结果是：</span><br><span class="line">	&apos;&#123;&quot;name&quot;:&quot;goatling&quot;&#125;&apos;*/</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p>
<p></p><p style="color:#a96b3e;">连接池</p><span style="color:rgb(99, 201, 192);font-size:15px;">“ 连接池运作原理在实际应用开发中，特别是在WEB应用系统中，如果JSP、Servlet或EJB使用JDBC直接访问数据库中的数据，每一次数据访问请求都必须经历建立数据库连接、打开数据库、存取数据和关闭数据库连接等步骤，而连接并打开数据库是一件既消耗资源又费时的工作，如果频繁发生这种数据库操作，系统的性能必然会急剧下降，甚至会导致系统崩溃。数据库连接池技术是解决这个问题最常用的方法，在许多应用程序服务器（例如：Weblogic,WebSphere,JBoss）中，基本都提供了这项技术，无需自己编程。 “</span><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const db=mysql.createPool(&#123;host:&apos;localhost&apos;,user:&apos;root&apos;,password:&apos;123456&apos;,database:&apos;blog&apos;&#125;);</span><br><span class="line"></span><br><span class="line">server.get(&apos;/&apos;,(req,res)=&gt;&#123;</span><br><span class="line">	//查询banner</span><br><span class="line">	db.query(&quot;SELECT * FROM banner_table&quot;,(err,data)=&gt;&#123;</span><br><span class="line">		if(err)&#123;</span><br><span class="line">			res.status(500).send(&apos;database error&apos;).end();</span><br><span class="line">			//status是状态码，500代表服务器内部错误</span><br><span class="line">		&#125;</span><br><span class="line">		else&#123;</span><br><span class="line">			res.render(&apos;index.ejs&apos;,&#123;banner:data&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p>
<p></p><p style="color:#846e5e;font-weight:bold">增删改查(数据库常用语句)</p>增<br><span style="color:rgb(185, 146, 219);font-weight:bold;">INSERT INTO 表名(字段列表) VALUES (值列表)</span><br><span style="color:rgb(131, 116, 145);">INSERT INTO user (`ID`,`user`,`password`) VALUES (0,`wjd`,`123`)<br></span><br>删<br><span style="color:rgb(185, 146, 219);font-weight:bold;">DELETE FROM 表名 WHERE 条件</span><br><span style="color:rgb(131, 116, 145);">DELETE FROM user_tb WHERE `ID`=4</span><br><br>改<br><span style="color:rgb(185, 146, 219);font-weight:bold;">UPDATE 表名 SET field1=new-value1, field2=new-value2 WHERE 条件</span><br><span style="color:rgb(131, 116, 145);">UPDATE user_tb SET `score`=80 WHERE `ID`=4</span><br><br>查<br><span style="color:rgb(185, 146, 219);font-weight:bold;">SELECT 列名,列名 FROM 表名 WHERE 条件</span><br><span style="color:rgb(131, 116, 145);">SELECT name,score FROM user_tb WHERE `score`&gt;60</span><p></p>
<p></p><p style="color:#846e5e;font-weight:bold">子句的运用</p>数据操作常用的有三种语句——条件[where 和 or and]，排序[order]，聚类[group,min,max,avg,count,sum]限制[limit]<br>子句的使用可以组合使用，但是最好按照如下顺序。<br><span style="color:rgb(160, 143, 151);">WHERE(筛选)-&gt;GROUP(合并)-&gt;ORDER(排序)-&gt;LIMIT(限制)</span><br><br><span style="color:#bbb953cc">ORDER</span><br>SELECT name,all_score FROM user_tb WHERE `all_score`&gt;130 ORDER BY math_score ASC,chinese_score DESC<br><span style="border-bottom:1px dotted rgb(194, 104, 19);">从一张名为user_tb的表中找到name，和all_score两列，首先需要符合all_score&gt;130的条件才能被筛选出来，然后按照math_score的大小升序排序，如果价格相同，则按照chinese_score降序排序</span><p></p>
<p><span style="color:#bbb953cc">GROUP</span><br>SELECT COUNT(*) FROM student_table<br><span style="border-bottom:1px dotted rgb(194, 104, 19);">查询结果为8，为记录条数</span><br>SELECT * FROM student_table GROUP BY class<br><span style="border-bottom:1px dotted rgb(194, 104, 19);">结果只剩下class未重复的第一条信息</span><br>SELECT class,COUNT(class) FROM student_table GROUP BY class<br><span style="border-bottom:1px dotted rgb(194, 104, 19);">可以计算出不同班级的总人数</span><br>SELECT class,AVG(all_score) FROM student_table GROUP BY class<br><span style="border-bottom:1px dotted rgb(194, 104, 19);">统计每个班的平均分</span></p>
<p><span style="color:#bbb953cc">LIMIT</span><br>LIMIT子句的这个功能，常见于“网页分页+每页显示最大数”的应用场景。<br>SELECT all_score FROM student_table LIMIT 3,2<br><span style="border-bottom:1px dotted rgb(194, 104, 19);">输出查询结果中第4行开始的共2条内容</span></p>

                    
                    <!-- Tags Bottom -->
                    
                        <div class="tags-container-bottom">
                            <i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/tags/学不完的js/">#学不完的js</a>
                        </div>
                    

                    <!-- Comments -->
                    



                </div>
                <div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50">
                    
                    <hr class="dn-l mw4 black-50 mt5">
                    
                    <!-- Widget 1: About -->
                    <div class="mt5 mt0-l">
    <article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3">
        <div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width: 6rem;">
            <img src="https://avatars.githubusercontent.com/u/49892998" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="gsnwjd王佳典">
        </div>
        <div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">
            热爱前端以及绘画 / 记忆力很差 / 深度近视 / 讨厌社交
        </div>
    </article>
</div>

                    <hr class="dn-l mw4 black-50 mt5">
                    
                    <!-- Widget 2: Categories -->
                    

                    <!-- Widget 3: Recent Posts -->
                    <div class="mt5 tc tl-l">
    <h3>近期文章</h3>
    
        <p>
            <a href="/2022/02/26/展示型Vue项目-·-细节拾取/">展示型Vue项目 · 细节拾取</a>
        </p>
    
        <p>
            <a href="/2022/02/22/word文件批量转化成统一模板/">word文件批量转化成统一模板</a>
        </p>
    
        <p>
            <a href="/2021/12/27/一小时聊完Less/">一小时聊完Less</a>
        </p>
    
        <p>
            <a href="/2020/08/25/试总结/">面试总结 : 一些细碎的知识点</a>
        </p>
    
        <p>
            <a href="/2020/08/23/6-7-8工作总结（say-goodbye-to-dunxi）/">打印，表单，富文本编辑器（踩坑记录）</a>
        </p>
    
</div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
<div class="bg-1 ph2 ph5-ns pv5">
        <div class="mv8">
            <div class="center tc">
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://dribbble.com/" target="_blank">
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://github.com/gsnwjd" target="_blank">
                            <i class="fa fa-github"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="pgldbm@foxmail.com" target="_blank">
                            <i class="fa fa-envelope"></i>
                        </a>
                    </div>
                
            </div>
            <div class="f6 f5-ns center tc white pt5 fw3">
                All right reserved | Design & Hexo <a class="link dim white" href="https://github.com/gsnwjd/">gsnwjd</a>
            </div>
        </div>
    </div>

<!-- After Footer -->
<!-- Disqus Comments -->



</body>

</html>